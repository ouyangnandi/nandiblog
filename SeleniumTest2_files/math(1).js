"use strict";goog.provide("Blockly.JavaScript.math");goog.require("Blockly.JavaScript");Blockly.JavaScript.math_number=function(){var a=window.parseFloat(this.getTitleValue("NUM"));return[a,Blockly.JavaScript.ORDER_ATOMIC]};Blockly.JavaScript.math_arithmetic=function(){var g=this.getTitleValue("OP");var b=Blockly.JavaScript.math_arithmetic.OPERATORS[g];var c=b[0];var a=b[1];var f=Blockly.JavaScript.valueToCode(this,"A",a)||"0";var e=Blockly.JavaScript.valueToCode(this,"B",a)||"0";var d;if(!c){d="Math.pow("+f+", "+e+")";return[d,Blockly.JavaScript.ORDER_FUNCTION_CALL]}d=f+c+e;return[d,a]};Blockly.JavaScript.math_arithmetic.OPERATORS={ADD:[" + ",Blockly.JavaScript.ORDER_ADDITION],MINUS:[" - ",Blockly.JavaScript.ORDER_SUBTRACTION],MULTIPLY:[" * ",Blockly.JavaScript.ORDER_MULTIPLICATION],DIVIDE:[" / ",Blockly.JavaScript.ORDER_DIVISION],POWER:[null,Blockly.JavaScript.ORDER_COMMA]};Blockly.JavaScript.math_single=function(){var b=this.getTitleValue("OP");var c;var a;if(b=="NEG"){a=Blockly.JavaScript.valueToCode(this,"NUM",Blockly.JavaScript.ORDER_UNARY_NEGATION)||"0";if(a[0]=="-"){a=" "+a}c="-"+a;return[c,Blockly.JavaScript.ORDER_UNARY_NEGATION]}if(b=="SIN"||b=="COS"||b=="TAN"){a=Blockly.JavaScript.valueToCode(this,"NUM",Blockly.JavaScript.ORDER_DIVISION)||"0"}else{a=Blockly.JavaScript.valueToCode(this,"NUM",Blockly.JavaScript.ORDER_NONE)||"0"}switch(b){case"ABS":c="Math.abs("+a+")";break;case"ROOT":c="Math.sqrt("+a+")";break;case"LN":c="Math.log("+a+")";break;case"EXP":c="Math.exp("+a+")";break;case"POW10":c="Math.pow(10,"+a+")";break;case"ROUND":c="Math.round("+a+")";break;case"ROUNDUP":c="Math.ceil("+a+")";break;case"ROUNDDOWN":c="Math.floor("+a+")";break;case"SIN":c="Math.sin("+a+" / 180 * Math.PI)";break;case"COS":c="Math.cos("+a+" / 180 * Math.PI)";break;case"TAN":c="Math.tan("+a+" / 180 * Math.PI)";break}if(c){return[c,Blockly.JavaScript.ORDER_FUNCTION_CALL]}switch(b){case"LOG10":c="Math.log("+a+") / Math.log(10)";break;case"ASIN":c="Math.asin("+a+") / Math.PI * 180";break;case"ACOS":c="Math.acos("+a+") / Math.PI * 180";break;case"ATAN":c="Math.atan("+a+") / Math.PI * 180";break;default:throw"Unknown math operator: "+b}return[c,Blockly.JavaScript.ORDER_DIVISION]};Blockly.JavaScript.math_constant=function(){var a=this.getTitleValue("CONSTANT");return Blockly.JavaScript.math_constant.CONSTANTS[a]};Blockly.JavaScript.math_constant.CONSTANTS={PI:["Math.PI",Blockly.JavaScript.ORDER_MEMBER],E:["Math.E",Blockly.JavaScript.ORDER_MEMBER],GOLDEN_RATIO:["(1 + Math.sqrt(5)) / 2",Blockly.JavaScript.ORDER_DIVISION],SQRT2:["Math.SQRT2",Blockly.JavaScript.ORDER_MEMBER],SQRT1_2:["Math.SQRT1_2",Blockly.JavaScript.ORDER_MEMBER],INFINITY:["Infinity",Blockly.JavaScript.ORDER_ATOMIC]};Blockly.JavaScript.math_number_property=function(){var e=Blockly.JavaScript.valueToCode(this,"NUMBER_TO_CHECK",Blockly.JavaScript.ORDER_MODULUS)||"NaN";var a=this.getTitleValue("PROPERTY");var c;if(a=="PRIME"){if(!Blockly.JavaScript.definitions_.isPrime){var d=Blockly.JavaScript.variableDB_.getDistinctName("isPrime",Blockly.Generator.NAME_TYPE);Blockly.JavaScript.logic_prime=d;var b=[];b.push("function "+d+"(n) {");b.push("  // http://en.wikipedia.org/wiki/Primality_test#Naive_methods");b.push("  if (n == 2 || n == 3) {");b.push("    return true;");b.push("  }");b.push("  // False if n is NaN, negative, is 1, or not whole.");b.push("  // And false if n is divisible by 2 or 3.");b.push("  if (isNaN(n) || n <= 1 || n % 1 != 0 || n % 2 == 0 || n % 3 == 0) {");b.push("    return false;");b.push("  }");b.push("  // Check all the numbers of form 6k +/- 1, up to sqrt(n).");b.push("  for (var x = 6; x <= Math.sqrt(n) + 1; x += 6) {");b.push("    if (n % (x - 1) == 0 || n % (x + 1) == 0) {");b.push("      return false;");b.push("    }");b.push("  }");b.push("  return true;");b.push("}");Blockly.JavaScript.definitions_.isPrime=b.join("\n")}c=Blockly.JavaScript.logic_prime+"("+e+")";return[c,Blockly.JavaScript.ORDER_FUNCTION_CALL]}switch(a){case"EVEN":c=e+" % 2 == 0";break;case"ODD":c=e+" % 2 == 1";break;case"WHOLE":c=e+" % 1 == 0";break;case"POSITIVE":c=e+" > 0";break;case"NEGATIVE":c=e+" < 0";break;case"DIVISIBLE_BY":var f=Blockly.JavaScript.valueToCode(this,"DIVISOR",Blockly.JavaScript.ORDER_MODULUS)||"NaN";c=e+" % "+f+" == 0";break}return[c,Blockly.JavaScript.ORDER_EQUALITY]};Blockly.JavaScript.math_change=function(){var a=Blockly.JavaScript.valueToCode(this,"DELTA",Blockly.JavaScript.ORDER_ADDITION)||"0";var b=Blockly.JavaScript.variableDB_.getName(this.getTitleValue("VAR"),Blockly.Variables.NAME_TYPE);return b+" = (typeof "+b+" == 'number' ? "+b+" : 0) + "+a+";\n"};Blockly.JavaScript.math_round=Blockly.JavaScript.math_single;Blockly.JavaScript.math_trig=Blockly.JavaScript.math_single;Blockly.JavaScript.math_on_list=function(){var b=this.getTitleValue("OP");var d,a;switch(b){case"SUM":d=Blockly.JavaScript.valueToCode(this,"LIST",Blockly.JavaScript.ORDER_MEMBER)||"[]";a=d+".reduce(function(x, y) {return x + y;})";break;case"MIN":d=Blockly.JavaScript.valueToCode(this,"LIST",Blockly.JavaScript.ORDER_COMMA)||"[]";a="Math.min.apply(null, "+d+")";break;case"MAX":d=Blockly.JavaScript.valueToCode(this,"LIST",Blockly.JavaScript.ORDER_COMMA)||"[]";a="Math.max.apply(null, "+d+")";break;case"AVERAGE":if(!Blockly.JavaScript.definitions_.math_mean){var c=Blockly.JavaScript.variableDB_.getDistinctName("math_mean",Blockly.Generator.NAME_TYPE);Blockly.JavaScript.math_on_list.math_mean=c;var b=[];b.push("function "+c+"(myList) {");b.push("  return myList.reduce(function(x, y) {return x + y;}) / myList.length;");b.push("}");Blockly.JavaScript.definitions_.math_mean=b.join("\n")}d=Blockly.JavaScript.valueToCode(this,"LIST",Blockly.JavaScript.ORDER_NONE)||"[]";a=Blockly.JavaScript.math_on_list.math_mean+"("+d+")";break;case"MEDIAN":if(!Blockly.JavaScript.definitions_.math_median){var c=Blockly.JavaScript.variableDB_.getDistinctName("math_median",Blockly.Generator.NAME_TYPE);Blockly.JavaScript.math_on_list.math_median=c;var b=[];b.push("function "+c+"(myList) {");b.push("  var localList = myList.filter(function (x) {return typeof x == 'number';});");b.push("  if (!localList.length) return null;");b.push("  localList.sort(function(a, b) {return b - a;});");b.push("  if (localList.length % 2 == 0) {");b.push("    return (localList[localList.length / 2 - 1] + localList[localList.length / 2]) / 2;");b.push("  } else {");b.push("    return localList[(localList.length - 1) / 2];");b.push("  }");b.push("}");Blockly.JavaScript.definitions_.math_median=b.join("\n")}d=Blockly.JavaScript.valueToCode(this,"LIST",Blockly.JavaScript.ORDER_NONE)||"[]";a=Blockly.JavaScript.math_on_list.math_median+"("+d+")";break;case"MODE":if(!Blockly.JavaScript.definitions_.math_modes){var c=Blockly.JavaScript.variableDB_.getDistinctName("math_modes",Blockly.Generator.NAME_TYPE);Blockly.JavaScript.math_on_list.math_modes=c;var b=[];b.push("function "+c+"(values) {");b.push("  var modes = [];");b.push("  var counts = [];");b.push("  var maxCount = 0;");b.push("  for (var i = 0; i < values.length; i++) {");b.push("    var value = values[i];");b.push("    var found = false;");b.push("    var thisCount;");b.push("    for (var j = 0; j < counts.length; j++) {");b.push("      if (counts[j][0] === value) {");b.push("        thisCount = ++counts[j][1];");b.push("        found = true;");b.push("        break;");b.push("      }");b.push("    }");b.push("    if (!found) {");b.push("      counts.push([value, 1]);");b.push("      thisCount = 1;");b.push("    }");b.push("    maxCount = Math.max(thisCount, maxCount);");b.push("  }");b.push("  for (var j = 0; j < counts.length; j++) {");b.push("    if (counts[j][1] == maxCount) {");b.push("        modes.push(counts[j][0]);");b.push("    }");b.push("  }");b.push("  return modes;");b.push("}");Blockly.JavaScript.definitions_.math_modes=b.join("\n")}d=Blockly.JavaScript.valueToCode(this,"LIST",Blockly.JavaScript.ORDER_NONE)||"[]";a=Blockly.JavaScript.math_on_list.math_modes+"("+d+")";break;case"STD_DEV":if(!Blockly.JavaScript.definitions_.math_standard_deviation){var c=Blockly.JavaScript.variableDB_.getDistinctName("math_standard_deviation",Blockly.Generator.NAME_TYPE);Blockly.JavaScript.math_on_list.math_standard_deviation=c;var b=[];b.push("function "+c+"(numbers) {");b.push("  var n = numbers.length;");b.push("  if (!n) return null;");b.push("  var mean = numbers.reduce(function(x, y) {return x + y;}) / n;");b.push("  var variance = 0;");b.push("  for (var j = 0; j < n; j++) {");b.push("    variance += Math.pow(numbers[j] - mean, 2);");b.push("  }");b.push("  variance = variance / n;");b.push("  return Math.sqrt(variance);");b.push("}");Blockly.JavaScript.definitions_.math_standard_deviation=b.join("\n")}d=Blockly.JavaScript.valueToCode(this,"LIST",Blockly.JavaScript.ORDER_NONE)||"[]";a=Blockly.JavaScript.math_on_list.math_standard_deviation+"("+d+")";break;case"RANDOM":if(!Blockly.JavaScript.definitions_.math_random_item){var c=Blockly.JavaScript.variableDB_.getDistinctName("math_random_item",Blockly.Generator.NAME_TYPE);Blockly.JavaScript.math_on_list.math_random_item=c;var b=[];b.push("function "+c+"(list) {");b.push("  var x = Math.floor(Math.random() * list.length);");b.push("  return list[x];");b.push("}");Blockly.JavaScript.definitions_.math_random_item=b.join("\n")}d=Blockly.JavaScript.valueToCode(this,"LIST",Blockly.JavaScript.ORDER_NONE)||"[]";a=Blockly.JavaScript.math_on_list.math_random_item+"("+d+")";break;default:throw"Unknown operator: "+b}return[a,Blockly.JavaScript.ORDER_FUNCTION_CALL]};Blockly.JavaScript.math_modulo=function(){var c=Blockly.JavaScript.valueToCode(this,"DIVIDEND",Blockly.JavaScript.ORDER_MODULUS)||"0";var b=Blockly.JavaScript.valueToCode(this,"DIVISOR",Blockly.JavaScript.ORDER_MODULUS)||"0";var a=c+" % "+b;return[a,Blockly.JavaScript.ORDER_MODULUS]};Blockly.JavaScript.math_constrain=function(){var d=Blockly.JavaScript.valueToCode(this,"VALUE",Blockly.JavaScript.ORDER_COMMA)||"0";var c=Blockly.JavaScript.valueToCode(this,"LOW",Blockly.JavaScript.ORDER_COMMA)||"0";var b=Blockly.JavaScript.valueToCode(this,"HIGH",Blockly.JavaScript.ORDER_COMMA)||"Infinity";var a="Math.min(Math.max("+d+", "+c+"), "+b+")";return[a,Blockly.JavaScript.ORDER_FUNCTION_CALL]};Blockly.JavaScript.math_random_int=function(){var e=Blockly.JavaScript.valueToCode(this,"FROM",Blockly.JavaScript.ORDER_COMMA)||"0";var d=Blockly.JavaScript.valueToCode(this,"TO",Blockly.JavaScript.ORDER_COMMA)||"0";if(!Blockly.JavaScript.definitions_.math_random_int){var c=Blockly.JavaScript.variableDB_.getDistinctName("math_random_int",Blockly.Generator.NAME_TYPE);Blockly.JavaScript.math_random_int.random_function=c;var b=[];b.push("function "+c+"(a, b) {");b.push("  if (a > b) {");b.push("    // Swap a and b to ensure a is smaller.");b.push("    var c = a;");b.push("    a = b;");b.push("    b = c;");b.push("  }");b.push("  return Math.floor(Math.random() * (b - a + 1) + a);");b.push("}");Blockly.JavaScript.definitions_.math_random_int=b.join("\n")}var a=Blockly.JavaScript.math_random_int.random_function+"("+e+", "+d+")";return[a,Blockly.JavaScript.ORDER_FUNCTION_CALL]};Blockly.JavaScript.math_random_float=function(){return["Math.random()",Blockly.JavaScript.ORDER_FUNCTION_CALL]};