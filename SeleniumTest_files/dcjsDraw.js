function ShowGraph(jsonServer){'use strict';var gainOrLossChart=dc.pieChart('#gain-loss-chart');var fluctuationChart=dc.barChart('#fluctuation-chart');var dayOfWeekChart=dc.rowChart('#day-of-week-chart');var regionChart=dc.rowChart('#region-chart');var yearlyBubbleChart=dc.bubbleChart('#yearly-bubble-chart');var data=JSON.parse(jsonServer);var numberFormat=d3.format('.2f');var ndx=crossfilter(data);var all=ndx.groupAll();var yearlyDimension=ndx.dimension(function(d){return d.aygain;});var yearlyPerformanceGroup=yearlyDimension.group().reduce(function(p,v){++p.count;p.aygain=v.aygain;p.ayvol=v.ayvol;p.aum=v.aum;p.aumRounded=v.aumRounded;p.region=v.region;p.sector=v.sector;p.key=v.key;p.asset=v.asset;return p;},function(p,v){--p.count;p.aygain-=v.aygain;p.ayvol-=v.ayvol;p.aum-=v.aum;p.aumRounded=v.aumRounded;p.sector=v.sector;p.region=v.region;p.key=v.key;p.asset=v.asset;return p;},function(){return{count:0,key:0,aygain:0,ayvol:0,aum:0,aumRounded:0,region:0,sector:0,asset:0};});var dateDimension=ndx.dimension(function(d){return d.dd;});var gainOrLoss=ndx.dimension(function(d){return d.aygain<0.0?'Loss':'Gain';});var gainOrLossGroup=gainOrLoss.group();var dayOfWeek=ndx.dimension(function(d){return d.sector+'.'+ d.sector;});var dayOfWeekGroup=dayOfWeek.group();var regionClasses=ndx.dimension(function(d){return d.region+'.'+ d.region;});var regionClassesGroup=regionClasses.group();var fluctuation=ndx.dimension(function(d){if(d.aumRounded>1500000000)
return 1500000000;else
return d.aumRounded;});var fluctuationGroup=fluctuation.group();function percentage(d){var x=d*100
return x.toFixed(2)+'%';};function aum23(d){return d.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",");};var colorDomain=['Equity','Fixed Income','Hybrid','Other','Real Estate','Alternatives'];var color=['#B4975A','#0066b3','#717171','#00B3f0','#d9261c','#D4E157'];yearlyBubbleChart.width(850).height(250).transitionDuration(1500).margins({top:10,right:50,bottom:30,left:40}).dimension(yearlyDimension).group(yearlyPerformanceGroup).colors(d3.scale.ordinal().domain(colorDomain).range(color)).keyAccessor(function(p){return p.value.ayvol*100;}).valueAccessor(function(p){return p.value.aygain*100;}).radiusValueAccessor(function(p){return p.value.aum/300000000;}).maxBubbleRelativeSize(0.3).x(d3.scale.linear().domain([-2,101])).y(d3.scale.linear().domain([-10,10])).r(d3.scale.linear().domain([0,4000])).elasticY(true).yAxisPadding(10).xAxisPadding(2).colorAccessor(function(p){return p.value.sector;}).renderHorizontalGridLines(true).renderVerticalGridLines(true).yAxisLabel("1Y Return (%)").xAxisLabel("1Y Volatility (%)").renderLabel(true).label(function(p){return"";}).renderTitle(true).title(function(p){return[p.value.asset,'Region: '+ p.value.region,'Asset Class: '+ p.value.sector,'Fund Size (Aum): '+'$'+ aum23(p.value.aum),'Return: '+ percentage(p.value.aygain),'Risk: '+ percentage(p.value.ayvol)].join('\n');})
gainOrLossChart.width(180).height(180).radius(80).dimension(gainOrLoss).group(gainOrLossGroup).ordinalColors(['#3182bd','#6baed6','#9ecae1','#c6dbef','#dadaeb']).label(function(d){if(gainOrLossChart.hasFilter()&&!gainOrLossChart.hasFilter(d.key)){return d.key+'(0%)';}
var label=d.key;if(all.value()){label+='('+(d.value/all.value()*100).toFixed(1)+'%)';}
return label;})
dayOfWeekChart.width(290).height(180).margins({top:20,left:10,right:10,bottom:20}).group(dayOfWeekGroup).dimension(dayOfWeek).colors(d3.scale.ordinal().domain(colorDomain).range(color)).colorAccessor(function(d){return d.key.split('.')[1];}).label(function(d){return d.key.split('.')[1];}).title(function(d){return d.value;}).elasticX(true).xAxis().ticks(4);regionChart.width(290).height(180).margins({top:20,left:10,right:10,bottom:20}).group(regionClassesGroup).dimension(regionClasses).ordinalColors(['#3182bd','#6baed6','#9ecae1','#c6dbef','#dadaeb']).label(function(d){return d.key.split('.')[1];}).title(function(d){return d.value;}).elasticX(true).xAxis().ticks(4);var FlucInit=0;var FlucEnd=0;for(var i=0;i<data.length;i++){if(data[i].aumRounded>1500000000){FlucEnd=1550000000;}else{if(FlucEnd<parseInt(data[i].aumRounded)){FlucEnd=data[i].aumRounded;}}}
fluctuationChart.width(850).height(190).margins({top:10,right:50,bottom:30,left:40}).dimension(fluctuation).group(fluctuationGroup).elasticY(true).centerBar(true).gap(1).round(dc.round.floor).alwaysUseRounding(true).x(d3.scale.linear().domain([FlucInit,FlucEnd])).renderHorizontalGridLines(true).filterPrinter(function(filters){var filter=filters[0],s='';s+='$'+ aum23(filter[0])+' -> '+'$'+ aum23(filter[1]);return s;});fluctuationChart.xAxis().tickFormat(function(v){return(v/1000000)+'m';});fluctuationChart.yAxis().ticks(4);dc.dataCount('.dc-data-count').dimension(ndx).group(all).html({some:'<strong>%filter-count</strong> selected out of <strong>%total-count</strong> records'+' | <a href=\'javascript:dc.filterAll(); dc.renderAll();\'\'>Reset All</a>',all:'All records selected. Please click on the graph to apply filters.'});dc.dataTable('.dc-data-table').dimension(dateDimension).group(function(d){return'Asset Class: '+ d.sector;}).size(30).columns([{label:'Fund',format:function(d){return'<a href="#investmentDetails;strategyKey='+ d.key+';hideBackButton=true;dataSource=" target="_blank">'+ d.asset+'</a>';}},{label:'Fund Code',format:function(d){return'<span style="float: right;">FUNDCODE</span>';}},{label:'Risk',format:function(d){return'<span style="float: right;">1</span>';}},{label:'Documents',format:function(d){return'<span style="padding-right:23px; float: right;"><a href="#investmentDetails;strategyKey='+ d.key+';hideBackButton=true;dataSource=;fundDoc=true" target="_blank"><img src="img/static/pdficon_small.png"></a></span>';}},{label:'1Y Return',format:function(d){var x=d.aygain*100;return'<span style="float: right; text-align:right;">'+ x.toFixed(2)+'%'+'</span>';}},{label:'1Y Volatility',format:function(d){var x=d.ayvol*100;return'<span style="float: right; text-align:right;">'+ x.toFixed(2)+'%'+'</span>';}},{label:'Region',format:function(d){return'<span style="float: right; text-align:right;">'+ d.region+'</span>';}},{label:'Fund Size (Aum)',format:function(d){return'<span style="float: right; text-align:right;">'+'$'+ d.aum.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")+'</span>';}}]).sortBy(function(d){return-d.aygain;}).renderlet(function(table){table.selectAll('.dc-table-group').classed('info',true);});dc.renderAll();}